<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fireworks</title>

<style>
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:black;
  overflow:hidden;
}

/* canvas */
canvas{
  position:absolute;
  top:0;
  left:0;
}

/* shake */
.shake{
  animation:shake 0.3s;
}
@keyframes shake{
  0%{transform:translate(0,0)}
  25%{transform:translate(6px,-6px)}
  50%{transform:translate(-6px,6px)}
  75%{transform:translate(6px,6px)}
  100%{transform:translate(0,0)}
}

/* fog */
#fog{
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at 30% 70%, rgba(255,255,255,0.04), transparent 60%),
    radial-gradient(circle at 70% 30%, rgba(255,255,255,0.03), transparent 60%);
  animation:fog 30s linear infinite;
  pointer-events:none;
}
@keyframes fog{
  from{transform:translateX(0)}
  to{transform:translateX(-300px)}
}
</style>
</head>

<body>

<canvas id="stars"></canvas>
<canvas id="fire"></canvas>
<div id="fog"></div>

<script>
/* canvas setup */
const starCanvas=document.getElementById("stars");
const fireCanvas=document.getElementById("fire");
const starCtx=starCanvas.getContext("2d");
const ctx=fireCanvas.getContext("2d");

function resize(){
  starCanvas.width=fireCanvas.width=innerWidth;
  starCanvas.height=fireCanvas.height=innerHeight;
}
resize();
window.onresize=resize;

/* stars */
let stars=[];
for(let i=0;i<200;i++){
  stars.push({
    x:Math.random()*innerWidth,
    y:Math.random()*innerHeight,
    r:Math.random()*1.5
  });
}
function drawStars(){
  starCtx.clearRect(0,0,innerWidth,innerHeight);
  starCtx.fillStyle="white";
  stars.forEach(s=>{
    starCtx.beginPath();
    starCtx.arc(s.x,s.y,s.r,0,Math.PI*2);
    starCtx.fill();
  });
}

/* audio (NO MP3) */
const AudioCtx=window.AudioContext||window.webkitAudioContext;
const audioCtx=new AudioCtx();
document.body.addEventListener("click",()=>audioCtx.resume(),{once:true});

function fireworkSound(){
  const noise=audioCtx.createBufferSource();
  const buffer=audioCtx.createBuffer(1,audioCtx.sampleRate*0.3,audioCtx.sampleRate);
  const data=buffer.getChannelData(0);
  for(let i=0;i<data.length;i++){
    data[i]=(Math.random()*2-1)*(1-i/data.length);
  }
  noise.buffer=buffer;

  const filter=audioCtx.createBiquadFilter();
  filter.type="lowpass";
  filter.frequency.value=700;

  const gain=audioCtx.createGain();
  gain.gain.value=1;

  noise.connect(filter);
  filter.connect(gain);
  gain.connect(audioCtx.destination);
  noise.start();

  document.body.classList.add("shake");
  setTimeout(()=>document.body.classList.remove("shake"),300);
}

/* fireworks */
let particles=[];
class Particle{
  constructor(x,y){
    const a=Math.random()*Math.PI*2;
    const s=Math.random()*7+3;
    this.x=x; this.y=y;
    this.vx=Math.cos(a)*s;
    this.vy=Math.sin(a)*s;
    this.life=120;
    this.color=`hsl(${Math.random()*360},100%,60%)`;
  }
  update(){
    this.vy+=0.05;
    this.x+=this.vx;
    this.y+=this.vy;
    this.life--;
  }
  draw(){
    ctx.fillStyle=this.color;
    ctx.beginPath();
    ctx.arc(this.x,this.y,3,0,Math.PI*2);
    ctx.fill();
  }
}

function explode(){
  const x=Math.random()*innerWidth;
  const y=Math.random()*innerHeight*0.5;
  for(let i=0;i<180;i++) particles.push(new Particle(x,y));
  fireworkSound();
}
setInterval(explode,1500);

/* animation */
function animate(){
  drawStars();
  ctx.fillStyle="rgba(0,0,0,0.25)";
  ctx.fillRect(0,0,innerWidth,innerHeight);

  particles=particles.filter(p=>{
    p.update();
    p.draw();
    return p.life>0;
  });

  requestAnimationFrame(animate);
}
animate();
</script>

</body>
</html>
